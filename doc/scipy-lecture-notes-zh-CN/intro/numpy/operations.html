<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.3.8. 数组的数值运算 &#8212; Scipy lecture notes</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2016.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="top" title="Scipy lecture notes" href="../../index.html" />
    <link rel="up" title="1.3. NumPy: 操作和处理数据" href="index.html" />
    <link rel="next" title="1.3.9. 数组内容进阶" href="elaborate_arrays.html" />
    <link rel="prev" title="1.3.1. 什么是Numpy和Numpy数组?" href="array_object.html" />
   
    <link rel="stylesheet"
	  href="http://yui.yahooapis.com/pure/0.6.0/base-min.css">

<script type="text/javascript">
$(function () {
    // Highlight the table of content as we scroll
    sections = {},
    i        = 0,
    url	 = document.URL.replace(/#.*$/, ""),
    current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();

	// Highlight the current section
	$('a.internal').parent().removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().parent().parent().addClass('active');
    });

});
</script>


  </head>
  <body role="document">
   <!-- Use the header to add javascript -->
    

    <script type="text/javascript">
    // Function to collapse the tip divs
    function collapse_tip_div(obj){
	// Update the representation on the tip div based on whether it
	// has the 'collapsed' css class or not: we only want to
	// collapse divs that are not already collapsed
	if($(obj).hasClass("collapsed")) {
	} else {
	    $(obj).find("p.summary").remove();
	    var content = $(obj).text();
	    var html = $(obj).html();

	    if(content.length > 40) {
		if ($.browser.msie) {
		    // We start at '3' to avoid 'tip', as IE
		    // does not count whitespace
		    var content = content.substr(3, 50);
		} else {
		    // We start at '5' to avoid 'tip '
		    var content = content.substr(5, 50);
		}
	    }
	    $(obj).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
	}
    }
    </script>

    <script type="text/javascript">
    $(function () {
	$(".tip")
	    .click(function(event){
		$(this).toggleClass("collapsed");
		// Change state of the global button
		$('div.related li.transparent').removeClass('transparent')
		$(this).find("p.summary").remove();
		if($(this).hasClass("collapsed")) {
		    var content = $(this).text();
		    var html = $(this).html();

		    if(content.length > 40) {
			if ($.browser.msie) {
			    // We start at '3' to avoid 'tip', as IE
			    // does not count whitespace
			    var content = content.substr(3, 50);
			} else {
			    // We start at '5' to avoid 'tip '
			    var content = content.substr(5, 50);
			}
		    }
		    $(this).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
		}
		if (event.target.tagName.toLowerCase() != "a") {
                   return true; //Makes links clickable
		}
	});
    });
    </script>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="elaborate_arrays.html" title="1.3.9. 数组内容进阶"
             accesskey="N">下一页</a></li>
        <li class="right" >
          <a href="array_object.html" title="1.3.1. 什么是Numpy和Numpy数组?"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Scipy lecture notes</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. 基础教程</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">1.3. NumPy: 操作和处理数据</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/jayleicn/scipy-lecture-notes-zh-CN/edit/master/intro/numpy/operations.rst">Edit
    <span class="tooltip">
	Improve this page:<br/>Translate/Improve it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>1.3.8. 数组的数值运算<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="contents local topic" id="section-contents">
<p class="topic-title first">Section contents</p>
<ul class="simple">
<li><a class="reference internal" href="#elementwise" id="id17">元素智能(elementwise)运算</a></li>
<li><a class="reference internal" href="#id4" id="id18">基本简化运算</a></li>
<li><a class="reference internal" href="#broadcasting" id="id19">Broadcasting</a></li>
<li><a class="reference internal" href="#id8" id="id20">数组形状操作</a></li>
<li><a class="reference internal" href="#id13" id="id21">数据排序</a></li>
<li><a class="reference internal" href="#id14" id="id22">总结</a></li>
</ul>
</div>
<div class="section" id="elementwise">
<h2><a class="toc-backref" href="#id17">1.3.8.1. 元素智能(elementwise)运算</a><a class="headerlink" href="#elementwise" title="永久链接至标题">¶</a></h2>
<div class="section" id="id2">
<h3>1.3.8.1.1. 基本运算<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>（数组）与标量：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<div class="newline"></div><span class="go">array([2, 3, 4, 5])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">**</span><span class="n">a</span>
<div class="newline"></div><span class="go">array([ 2,  4,  8, 16])</span>
<div class="newline"></div></pre></div>
</div>
<p>所有运算符都是元素智能的：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([-1.,  0.,  1.,  2.])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([ 2.,  4.,  6.,  8.])</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span>
<div class="newline"></div><span class="go">array([ 2,  3,  6, 13, 28])</span>
<div class="newline"></div></pre></div>
</div>
<p>并且NumPy比纯Python的计算速度快多了：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">timeit</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>  
<div class="newline"></div><span class="go">10000 loops, best of 3: 24.3 us per loop</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">timeit</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span> 
<div class="newline"></div><span class="go">1000 loops, best of 3: 861 us per loop</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p><strong>数组乘法并非矩阵乘法：</strong></p>
<div class="last highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">*</span> <span class="n">c</span>                   <span class="c1"># 不是矩阵乘法！</span>
<div class="newline"></div><span class="go">array([[ 1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p><strong>矩阵乘法的实现：</strong></p>
<div class="last highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([[ 3.,  3.,  3.],</span>
<div class="newline"></div><span class="go">       [ 3.,  3.,  3.],</span>
<div class="newline"></div><span class="go">       [ 3.,  3.,  3.]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="green topic">
<p class="topic-title first"><strong>练习：元素智能运算</strong></p>
<blockquote>
<div><ul class="simple">
<li>试试简单的元素智能运算：将偶数元素与奇数元素相加</li>
<li>用 <code class="docutils literal"><span class="pre">%timeit</span></code> 指令比较NumPy与纯Python下的运算速度</li>
<li>运行如下语句：<ul>
<li><code class="docutils literal"><span class="pre">[2**0,</span> <span class="pre">2**1,</span> <span class="pre">2**2,</span> <span class="pre">2**3,</span> <span class="pre">2**4]</span></code></li>
<li><code class="docutils literal"><span class="pre">a_j</span> <span class="pre">=</span> <span class="pre">2^(3*j)</span> <span class="pre">-</span> <span class="pre">j</span></code></li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id3">
<h3>1.3.8.1.2. 其他运算<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p><strong>比较：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([False,  True, False,  True], dtype=bool)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([False, False,  True, False], dtype=bool)</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>逻辑运算：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ True,  True,  True, False], dtype=bool)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ True, False, False, False], dtype=bool)</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>超越函数：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ 0.        ,  0.84147098,  0.90929743,  0.14112001, -0.7568025 ])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([       -inf,  0.        ,  0.69314718,  1.09861229,  1.38629436])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([  1.        ,   2.71828183,   7.3890561 ,  20.08553692,  54.59815003])</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>数组大小不匹配：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>  
<div class="newline"></div><span class="gt">Traceback (most recent call last):</span>
<div class="newline"></div>  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<div class="newline"></div><span class="gr">ValueError</span>: <span class="n">operands could not be broadcast together with shapes (4) (2)</span>
<div class="newline"></div></pre></div>
</div>
<p><em>Broadcasting?</em> We&#8217;ll return to that <a class="reference internal" href="#broadcasting"><span class="std std-ref">later</span></a>.</p>
<p><strong>转置：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># see help(np.triu)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.,  1.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.,  0.]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="go">array([[ 0.,  0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 1.,  0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  0.]])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p><strong>转置操作只产生数组的view</strong></p>
<p>因此下列代码 <strong>是错的</strong>， <strong>不会返回对称矩阵</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div></pre></div>
</div>
<p class="last">对于小矩阵而言或许可以（由于缓冲区），但对大矩阵，上述代码会返回不可预料的内容。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p><strong>线性代数</strong></p>
<p class="last">子模块 <code class="xref py py-mod docutils literal"><span class="pre">numpy.linalg</span></code> 是线性代数运算的补充，例如解线性方程组，分解奇异值等等。然而它不能保证最佳效率，我们推荐使用 <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/linalg.html#module-scipy.linalg" title="(在 SciPy v0.19.0)"><code class="xref py py-mod docutils literal"><span class="pre">scipy.linalg</span></code></a> ，这在 <a class="reference internal" href="../scipy.html#scipy-linalg"><span class="std std-ref">线性代数操作: scipy.linalg</span></a> 介绍。</p>
</div>
<div class="green topic">
<p class="topic-title first">练习其他运算</p>
<blockquote>
<div><ul class="simple">
<li>查阅 <code class="docutils literal"><span class="pre">np.allclose</span></code> 的帮助文档，它有啥用？</li>
<li>查阅 <code class="docutils literal"><span class="pre">np.triu</span></code> 和 <code class="docutils literal"><span class="pre">np.tril</span></code> 的帮助文档。</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id18">1.3.8.2. 基本简化运算</a><a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="section" id="id5">
<h3>1.3.8.2.1. 求和<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<div class="newline"></div><span class="go">10</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">10</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/reductions.png" class="align-right" src="../../_images/reductions.png" />
<p>按行、列分别求和：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([[1, 1],</span>
<div class="newline"></div><span class="go">       [2, 2]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># 按列求和（第一维）</span>
<div class="newline"></div><span class="go">array([3, 3])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">(3, 3)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># 按行求和（第二维）</span>
<div class="newline"></div><span class="go">array([2, 4])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">(2, 4)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p>高维数组求和的方法类似：</p>
<div class="last highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>     
<div class="newline"></div><span class="go">1.14764...</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>     
<div class="newline"></div><span class="go">1.14764...</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>1.3.8.2.2. 其它简化运算<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>&#8212; 格式与求和运算类似（比如 <code class="docutils literal"><span class="pre">axis</span></code>）</p>
<p><strong>极值：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<div class="newline"></div><span class="go">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<div class="newline"></div><span class="go">3</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c1"># 返回最小值的索引</span>
<div class="newline"></div><span class="go">0</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>  <span class="c1"># 返回最大值的索引</span>
<div class="newline"></div><span class="go">1</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>逻辑运算：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<div class="newline"></div><span class="go">False</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p>上述逻辑运算可用于数组间比较：</p>
<div class="last highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">False</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
</div>
<p><strong>统计：</strong></p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<div class="newline"></div><span class="go">1.75</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<div class="newline"></div><span class="go">1.5</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># last axis</span>
<div class="newline"></div><span class="go">array([ 2.,  5.])</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>          <span class="c1"># 整体标准差</span>
<div class="newline"></div><span class="go">0.82915619758884995</span>
<div class="newline"></div></pre></div>
</div>
<p>... 其它运算可在实践中查阅、使用。</p>
<div class="green topic">
<p class="topic-title first"><strong>练习：简化运算</strong></p>
<blockquote>
<div><ul class="simple">
<li>你能想到哪些有关 <code class="docutils literal"><span class="pre">sum</span></code> 函数的其他函数？</li>
<li><code class="docutils literal"><span class="pre">sum</span></code> 与 <code class="docutils literal"><span class="pre">cumsum</span></code> 之间有什么差别？</li>
</ul>
</div></blockquote>
</div>
<div class="green topic">
<p class="topic-title first">实例：数据统计</p>
<p>数据见 <a class="reference download internal" href="../../_downloads/populations.txt" download=""><code class="xref download docutils literal"><span class="pre">populations.txt</span></code></a></p>
<p>数据内容是加拿大北部20年的野兔、山猫以及胡萝卜数。</p>
<p>可以在文本编辑器查看这些数据，或者在IPython的shell或notebook里查看:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="err">!</span><span class="n">cat</span> <span class="n">data</span><span class="o">/</span><span class="n">populations</span><span class="o">.</span><span class="n">txt</span>
<div class="newline"></div></pre></div>
</div>
<p>首先将这些数据导入为NumPy数组:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data/populations.txt&#39;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># trick: columns to variables</span>
<div class="newline"></div></pre></div>
</div>
<p>然后绘图:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span> 
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span> 
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Hare&#39;</span><span class="p">,</span> <span class="s1">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> 
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_4.png" src="../../_images/numpy_intro_4.png" />
<p>计算平均数量:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ 34080.95238095,  20166.66666667,  42400.        ])</span>
<div class="newline"></div></pre></div>
</div>
<p>样本标准差:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ 20897.90645809,  16254.59153691,   3322.50622558])</span>
<div class="newline"></div></pre></div>
</div>
<p>每一年数量最多的物种是？</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">populations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([2, 2, 0, 0, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0, 1, 2, 2, 2, 2, 2])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="topic">
<p class="topic-title first">实例：用随机行走算法模拟的扩散行为</p>
<img alt="../../_images/random_walk.png" class="align-center" src="../../_images/random_walk.png" />
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p>考虑简单的一维随机行走过程：行人每次等概率地向左或向右随机移动一格。</p>
<p class="last">我们想求出经历 <code class="docutils literal"><span class="pre">t</span></code> 次向左或右的移动后，行人到原点距离的期望值。下面通过模拟多个随机行人求解，这里用到一些数组运算技巧：我们创建一个二维数组，其中一维叫做‘stories’（每个行人对应一个story），另一维表示每次的移动（称为时间维度）：</p>
</div>
<a class="reference internal image-reference" href="../../_images/random_walk_schema.png"><img alt="../../_images/random_walk_schema.png" class="align-center" src="../../_images/random_walk_schema.png" style="width: 100%;" /></a>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n_stories</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># number of walkers</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">t_max</span> <span class="o">=</span> <span class="mi">200</span>      <span class="c1"># time during which we follow the walker</span>
<div class="newline"></div></pre></div>
</div>
<p>每次移动在1与-1之间等概率选择：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">steps</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n_stories</span><span class="p">,</span> <span class="n">t_max</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="c1"># Verification: all steps are 1 or -1</span>
<div class="newline"></div><span class="go">array([-1,  1])</span>
<div class="newline"></div></pre></div>
</div>
<p>通过（在时间维度）求和计算移动的距离：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># axis = 1: dimension of time</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">sq_distance</span> <span class="o">=</span> <span class="n">positions</span><span class="o">**</span><span class="mi">2</span>
<div class="newline"></div></pre></div>
</div>
<p>在story维度计算行人移动的平均距离：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mean_sq_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sq_distance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>结果绘图：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.figure.Figure object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_sq_distance</span><span class="p">),</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;y-&#39;</span><span class="p">)</span> 
<div class="newline"></div><span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;, &lt;matplotlib.lines.Line2D object at ...&gt;]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$t$&quot;</span><span class="p">)</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.text.Text object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\sqrt{\langle (\delta x)^2 \rangle}$&quot;</span><span class="p">)</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.text.Text object at ...&gt;</span>
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_5.png" src="../../_images/numpy_intro_5.png" />
<p>由此导出了物理学中的著名结论：随机行走的均方根距离正比于时间的平方根。</p>
</div>
</div>
</div>
<div class="section" id="broadcasting">
<span id="id7"></span><h2><a class="toc-backref" href="#id19">1.3.8.3. Broadcasting</a><a class="headerlink" href="#broadcasting" title="永久链接至标题">¶</a></h2>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">NumPy</span></code> 数组的基本操作（比如加法）都是元素智能的。</p>
</li>
<li><p class="first">这当然要求进行运算的两个数组尺寸相同。</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>然而</strong> ，不同尺寸的数组之间也可能进行运算，如果 <em>NumPy</em> 可以将它们转化为相同尺寸的数组。</div>
<div class="line">这一转化过程称为 <strong>broadcasting</strong>。</div>
</div>
</div></blockquote>
</li>
</ul>
<p>下面是broadcasting操作的示意图：</p>
<a class="reference internal image-reference" href="../../_images/numpy_broadcasting.png"><img alt="../../_images/numpy_broadcasting.png" class="align-center" src="../../_images/numpy_broadcasting.png" style="width: 100%;" /></a>
<p>实际验证一下：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0,  0,  0],</span>
<div class="newline"></div><span class="go">       [10, 10, 10],</span>
<div class="newline"></div><span class="go">       [20, 20, 20],</span>
<div class="newline"></div><span class="go">       [30, 30, 30]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([[ 0,  1,  2],</span>
<div class="newline"></div><span class="go">       [10, 11, 12],</span>
<div class="newline"></div><span class="go">       [20, 21, 22],</span>
<div class="newline"></div><span class="go">       [30, 31, 32]])</span>
<div class="newline"></div></pre></div>
</div>
<p>在学习broadcasting之前，我们其实早已用过它了:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># 将一个数2（视为零维数组）赋值给一维数组a[0]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 2.,  2.,  2.,  2.,  2.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.,  1.,  1.]])</span>
<div class="newline"></div></pre></div>
</div>
<p>下面是一个常用技巧:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(4,)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c1"># adds a new axis -&gt; 2D array</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(4, 1)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0],</span>
<div class="newline"></div><span class="go">       [10],</span>
<div class="newline"></div><span class="go">       [20],</span>
<div class="newline"></div><span class="go">       [30]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([[ 0,  1,  2],</span>
<div class="newline"></div><span class="go">       [10, 11, 12],</span>
<div class="newline"></div><span class="go">       [20, 21, 22],</span>
<div class="newline"></div><span class="go">       [30, 31, 32]])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">Broadcasting seems a bit magical, but it is actually quite natural to
use it when we want to solve a problem whose output data is an array
with more dimensions than input data.
broadcasting操作看起来有点复杂，但在输出数组数据的维度比输入数组维度更多的时候，
broadcasting是非常自然的。</p>
</div>
<div class="green topic">
<p class="topic-title first">实例：broadcasting操作</p>
<p>下面创建沿66号公路的城市距离的数组（单位为英里），对应的城市：Chicago, Springfield,
Saint-Louis, Tulsa, Oklahoma City, Amarillo, Santa Fe, Albuquerque, Flagstaff and
Los Angeles.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mileposts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">736</span><span class="p">,</span> <span class="mi">871</span><span class="p">,</span> <span class="mi">1175</span><span class="p">,</span> <span class="mi">1475</span><span class="p">,</span> <span class="mi">1544</span><span class="p">,</span>
<div class="newline"></div><span class="gp">... </span>       <span class="mi">1913</span><span class="p">,</span> <span class="mi">2448</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mileposts</span> <span class="o">-</span> <span class="n">mileposts</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance_array</span>
<div class="newline"></div><span class="go">array([[   0,  198,  303,  736,  871, 1175, 1475, 1544, 1913, 2448],</span>
<div class="newline"></div><span class="go">       [ 198,    0,  105,  538,  673,  977, 1277, 1346, 1715, 2250],</span>
<div class="newline"></div><span class="go">       [ 303,  105,    0,  433,  568,  872, 1172, 1241, 1610, 2145],</span>
<div class="newline"></div><span class="go">       [ 736,  538,  433,    0,  135,  439,  739,  808, 1177, 1712],</span>
<div class="newline"></div><span class="go">       [ 871,  673,  568,  135,    0,  304,  604,  673, 1042, 1577],</span>
<div class="newline"></div><span class="go">       [1175,  977,  872,  439,  304,    0,  300,  369,  738, 1273],</span>
<div class="newline"></div><span class="go">       [1475, 1277, 1172,  739,  604,  300,    0,   69,  438,  973],</span>
<div class="newline"></div><span class="go">       [1544, 1346, 1241,  808,  673,  369,   69,    0,  369,  904],</span>
<div class="newline"></div><span class="go">       [1913, 1715, 1610, 1177, 1042,  738,  438,  369,    0,  535],</span>
<div class="newline"></div><span class="go">       [2448, 2250, 2145, 1712, 1577, 1273,  973,  904,  535,    0]])</span>
<div class="newline"></div></pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/route66.png"><img alt="../../_images/route66.png" class="align-center" src="../../_images/route66.png" style="width: 342.0px; height: 210.0px;" /></a>
</div>
<p>许多基于网格或网络的问题都可以利用broadcasting求解。例如计算10×10网格上某格点到原点的
距离：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span>
<div class="newline"></div><span class="go">array([[ 0.        ,  1.        ,  2.        ,  3.        ,  4.        ],</span>
<div class="newline"></div><span class="go">       [ 1.        ,  1.41421356,  2.23606798,  3.16227766,  4.12310563],</span>
<div class="newline"></div><span class="go">       [ 2.        ,  2.23606798,  2.82842712,  3.60555128,  4.47213595],</span>
<div class="newline"></div><span class="go">       [ 3.        ,  3.16227766,  3.60555128,  4.24264069,  5.        ],</span>
<div class="newline"></div><span class="go">       [ 4.        ,  4.12310563,  4.47213595,  5.        ,  5.65685425]])</span>
<div class="newline"></div></pre></div>
</div>
<p>上面的结果还可用颜色图表示：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>    
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>    
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_6.png" src="../../_images/numpy_intro_6.png" />
<p><strong>注意</strong> ： <code class="docutils literal"><span class="pre">numpy.ogrid</span></code> 函数可以直接创建上述例子中的两个
“重要维度”上的 <code class="docutils literal"><span class="pre">x</span></code> , <code class="docutils literal"><span class="pre">y</span></code> 向量，</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<div class="newline"></div><span class="go">(array([[0],</span>
<div class="newline"></div><span class="go">       [1],</span>
<div class="newline"></div><span class="go">       [2],</span>
<div class="newline"></div><span class="go">       [3],</span>
<div class="newline"></div><span class="go">       [4]]), array([[0, 1, 2, 3, 4]]))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">((5, 1), (1, 5))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p>因此， <code class="docutils literal"><span class="pre">np.ogrid</span></code> 在处理网格计算问题中十分有用。另一方面， <code class="docutils literal"><span class="pre">np.mgrid</span></code> 函数直接提供
了完整的矩阵，这样就不需利用broadcasting操作了。</p>
<div class="last highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([[0, 0, 0, 0],</span>
<div class="newline"></div><span class="go">       [1, 1, 1, 1],</span>
<div class="newline"></div><span class="go">       [2, 2, 2, 2],</span>
<div class="newline"></div><span class="go">       [3, 3, 3, 3]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([[0, 1, 2, 3],</span>
<div class="newline"></div><span class="go">       [0, 1, 2, 3],</span>
<div class="newline"></div><span class="go">       [0, 1, 2, 3],</span>
<div class="newline"></div><span class="go">       [0, 1, 2, 3]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id20">1.3.8.4. 数组形状操作</a><a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<div class="section" id="id9">
<h3>1.3.8.4.1. 扁平化<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<div class="newline"></div><span class="go">array([1, 2, 3, 4, 5, 6])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="go">array([[1, 4],</span>
<div class="newline"></div><span class="go">       [2, 5],</span>
<div class="newline"></div><span class="go">       [3, 6]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<div class="newline"></div><span class="go">array([1, 4, 2, 5, 3, 6])</span>
<div class="newline"></div></pre></div>
</div>
<p>对于多维数组：最后一维最先提取。</p>
</div>
<div class="section" id="id10">
<h3>1.3.8.4.2. 整形<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>整形操作可以看成是上面扁平化操作的逆过程：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(2, 3)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<div class="newline"></div><span class="go">array([[1, 2, 3],</span>
<div class="newline"></div><span class="go">       [4, 5, 6]])</span>
<div class="newline"></div></pre></div>
</div>
<p>或者，</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>    <span class="c1"># (-1)表示相应的维数由程序推断</span>
<div class="newline"></div><span class="go">array([[1, 2, 3],</span>
<div class="newline"></div><span class="go">       [4, 5, 6]])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last"><code class="docutils literal"><span class="pre">ndarray.reshape</span></code> <strong>可能</strong> 返回数组的view(cf <code class="docutils literal"><span class="pre">help(np.reshape)</span></code>)或复制。</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[99,  2,  3],</span>
<div class="newline"></div><span class="go">       [ 4,  5,  6]])</span>
<div class="newline"></div></pre></div>
</div>
<p>注意：整形操作也可能返回数组的复制！</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.]])</span>
<div class="newline"></div></pre></div>
</div>
<p class="last">理解上述过程需要对NumPy数组的内存设计深入了解。</p>
</div>
</div>
<div class="section" id="id11">
<h3>1.3.8.4.3. 添加维度<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<p>在数组索引时添加 <code class="docutils literal"><span class="pre">np.newaxis</span></code> 对象可以是数组添加一个维度。（在前面broadcasting章节里
我们已经见过了）：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span>
<div class="newline"></div><span class="go">array([1, 2, 3])</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<div class="newline"></div><span class="go">array([[1],</span>
<div class="newline"></div><span class="go">       [2],</span>
<div class="newline"></div><span class="go">       [3]])</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
<div class="newline"></div><span class="go">array([[1, 2, 3]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="shuffling">
<h3>1.3.8.4.4. 维度shuffling<a class="headerlink" href="#shuffling" title="永久链接至标题">¶</a></h3>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(4, 3, 2)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="go">5</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(3, 2, 4)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<div class="newline"></div><span class="go">5</span>
<div class="newline"></div></pre></div>
</div>
<p>它输出的是源数组的view：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="go">-1</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>1.3.8.4.5. 改变尺寸<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>数组的尺寸可以用 <code class="docutils literal"><span class="pre">ndarray.resize</span></code> 改变：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">8</span><span class="p">,))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([0, 1, 2, 3, 0, 0, 0, 0])</span>
<div class="newline"></div></pre></div>
</div>
<p>然而，被改变尺寸的数组不能被其他对象引用：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">4</span><span class="p">,))</span>   
<div class="newline"></div><span class="gt">Traceback (most recent call last):</span>
<div class="newline"></div>  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<div class="newline"></div><span class="gr">ValueError</span>: <span class="n">cannot resize an array that has been referenced or is</span>
<div class="newline"></div><span class="go">referencing another array in this way.  Use the resize function</span>
<div class="newline"></div></pre></div>
</div>
<div class="green topic">
<p class="topic-title first"><strong>练习: 数组尺寸操作</strong></p>
<ul class="simple">
<li>查阅 <code class="docutils literal"><span class="pre">reshape</span></code> 的帮助文档，特别是有关数组的复制与view的部分。</li>
<li>使用 <code class="docutils literal"><span class="pre">flatten</span></code> 替代 <code class="docutils literal"><span class="pre">ravel</span></code> ，他们有什么不同？（提示：检验哪一个返回数组的view，</li>
</ul>
<p>哪一个返回复制）
+ 尝试利用 <code class="docutils literal"><span class="pre">transpose</span></code> 进行维度shuffling。</p>
</div>
</div>
</div>
<div class="section" id="id13">
<h2><a class="toc-backref" href="#id21">1.3.8.5. 数据排序</a><a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<p>可以在数组的某一维度上排序：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<div class="newline"></div><span class="go">array([[3, 4, 5],</span>
<div class="newline"></div><span class="go">       [1, 1, 2]])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">各行分别进行排序。</p>
</div>
<p>原地排序：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[3, 4, 5],</span>
<div class="newline"></div><span class="go">       [1, 1, 2]])</span>
<div class="newline"></div></pre></div>
</div>
<p>排序与数组索引技巧结合：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<div class="newline"></div><span class="go">array([2, 3, 1, 0])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<div class="newline"></div><span class="go">array([1, 2, 3, 4])</span>
<div class="newline"></div></pre></div>
</div>
<p>找出极大、极小值对应的元素索引：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j_max</span><span class="p">,</span> <span class="n">j_min</span>
<div class="newline"></div><span class="go">(0, 2)</span>
<div class="newline"></div></pre></div>
</div>
<div class="green topic">
<p class="topic-title first"><strong>练习：排序</strong></p>
<blockquote>
<div><ul class="simple">
<li>尝试原地排序与异地排序</li>
<li>创建其他类型的数组，进行排序</li>
<li>使用 <code class="docutils literal"><span class="pre">all</span></code> 和 <code class="docutils literal"><span class="pre">array_equal</span></code> 命令检验结果</li>
<li>查阅 <code class="docutils literal"><span class="pre">np.random.shuffle</span></code> 帮助文档，它可以更快地创建待排序的内容</li>
<li>结合 <code class="docutils literal"><span class="pre">ravel</span></code>， <code class="docutils literal"><span class="pre">sort</span></code> 和 <code class="docutils literal"><span class="pre">reshape</span></code> 试试看</li>
<li>查阅 <code class="docutils literal"><span class="pre">sort</span></code> 命令的 <code class="docutils literal"><span class="pre">axis</span></code> 关键词，将前面的练习重写一遍</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id14">
<h2><a class="toc-backref" href="#id22">1.3.8.6. 总结</a><a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<p><strong>学过本节的好处都有啥？</strong></p>
<ul>
<li><p class="first">知道怎样创建NumPy数组：<code class="docutils literal"><span class="pre">array</span></code>, <code class="docutils literal"><span class="pre">arange</span></code>, <code class="docutils literal"><span class="pre">ones</span></code>,
<code class="docutils literal"><span class="pre">zeros</span></code>.</p>
</li>
<li><p class="first">知道 <code class="docutils literal"><span class="pre">array.shape``可以查看数组尺寸，利用切片操作获得数组的view，比如</span> <span class="pre">``array[::2]</span></code>。利用 <code class="docutils literal"><span class="pre">reshape</span></code> 调整数组尺寸，或者用 <a href="#id15"><span class="problematic" id="id16">``</span></a>ravel``将数组扁平化。</p>
</li>
<li><p class="first">获得数组元素的子集，利用掩码(mask)机智地编辑数组。例如：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">了解数组的各种运算，比如求平均值或最大值(<code class="docutils literal"><span class="pre">array.max()</span></code>, <code class="docutils literal"><span class="pre">array.mean()</span></code>)，不需要啥都记住，只需要了解有这回事，具体内容查阅帮助文档就好了（在线文档， <code class="docutils literal"><span class="pre">help()</span></code>,  <code class="docutils literal"><span class="pre">lookfor()</span></code> 等等）。</p>
</li>
<li><p class="first">高阶水平：熟练掌握数组索引与broadcasting，了解更多的NumPy函数以处理更复杂的数组操作。</p>
</li>
</ul>
<div class="topic">
<p class="topic-title first"><strong>快速阅读</strong></p>
<p>想要快速学习生态系统(ecosystem)的读者可以直接进入下一章 <a class="reference internal" href="../matplotlib/matplotlib.html#matplotlib"><span class="std std-ref">Matplotlib: 绘图</span></a>.</p>
<p>本章其余的内容作为选读，跳过不影响其他章节的学习。但是:ref:<cite>exercices &lt;numpy_exercises&gt;</cite> 需要其中的某些内容。</p>
</div>
<p><div style="clear: both"></div></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
	<div class="sidebartoc">
  <h3><a href="../../index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.3.8. 数组的数值运算</a><ul>
<li><a class="reference internal" href="#elementwise">1.3.8.1. 元素智能(elementwise)运算</a><ul>
<li><a class="reference internal" href="#id2">1.3.8.1.1. 基本运算</a></li>
<li><a class="reference internal" href="#id3">1.3.8.1.2. 其他运算</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">1.3.8.2. 基本简化运算</a><ul>
<li><a class="reference internal" href="#id5">1.3.8.2.1. 求和</a></li>
<li><a class="reference internal" href="#id6">1.3.8.2.2. 其它简化运算</a></li>
</ul>
</li>
<li><a class="reference internal" href="#broadcasting">1.3.8.3. Broadcasting</a></li>
<li><a class="reference internal" href="#id8">1.3.8.4. 数组形状操作</a><ul>
<li><a class="reference internal" href="#id9">1.3.8.4.1. 扁平化</a></li>
<li><a class="reference internal" href="#id10">1.3.8.4.2. 整形</a></li>
<li><a class="reference internal" href="#id11">1.3.8.4.3. 添加维度</a></li>
<li><a class="reference internal" href="#shuffling">1.3.8.4.4. 维度shuffling</a></li>
<li><a class="reference internal" href="#id12">1.3.8.4.5. 改变尺寸</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">1.3.8.5. 数据排序</a></li>
<li><a class="reference internal" href="#id14">1.3.8.6. 总结</a></li>
</ul>
</li>
</ul>
</div>



    <div class="script_container">
    <script>
    (function() {
	var cx = '004523248466141510607:hgv2yimrahw';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
	    '//cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search></gcse:search>
    </div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="elaborate_arrays.html" title="1.3.9. 数组内容进阶"
             >下一页</a></li>
        <li class="right" >
          <a href="array_object.html" title="1.3.1. 什么是Numpy和Numpy数组?"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Scipy lecture notes</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. 基础教程</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >1.3. NumPy: 操作和处理数据</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/jayleicn/scipy-lecture-notes-zh-CN/edit/master/intro/numpy/operations.rst">Edit
    <span class="tooltip">
	Improve this page:<br/>Translate/Improve it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6 创建。
    </div>
  </body>
</html>