<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3.1. 在Python中进行统计分析 &#8212; Scipy lecture notes</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2016.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="top" title="Scipy lecture notes" href="../../index.html" />
    <link rel="up" title="3. Packages and applications" href="../index.html" />
    <link rel="next" title="3.1.6.1. Examples" href="auto_examples/index.html" />
    <link rel="prev" title="3. Packages and applications" href="../index.html" />
   
    <link rel="stylesheet"
	  href="http://yui.yahooapis.com/pure/0.6.0/base-min.css">

<script type="text/javascript">
$(function () {
    // Highlight the table of content as we scroll
    sections = {},
    i        = 0,
    url	 = document.URL.replace(/#.*$/, ""),
    current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();

	// Highlight the current section
	$('a.internal').parent().removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().addClass('active');
	$('a.internal[href$="' + current_section + '"]').parent().parent().parent().parent().parent().addClass('active');
    });

});
</script>


  </head>
  <body role="document">
   <!-- Use the header to add javascript -->
    

    <script type="text/javascript">
    // Function to collapse the tip divs
    function collapse_tip_div(obj){
	// Update the representation on the tip div based on whether it
	// has the 'collapsed' css class or not: we only want to
	// collapse divs that are not already collapsed
	if($(obj).hasClass("collapsed")) {
	} else {
	    $(obj).find("p.summary").remove();
	    var content = $(obj).text();
	    var html = $(obj).html();

	    if(content.length > 40) {
		if ($.browser.msie) {
		    // We start at '3' to avoid 'tip', as IE
		    // does not count whitespace
		    var content = content.substr(3, 50);
		} else {
		    // We start at '5' to avoid 'tip '
		    var content = content.substr(5, 50);
		}
	    }
	    $(obj).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
	}
    }
    </script>

    <script type="text/javascript">
    $(function () {
	$(".tip")
	    .click(function(event){
		$(this).toggleClass("collapsed");
		// Change state of the global button
		$('div.related li.transparent').removeClass('transparent')
		$(this).find("p.summary").remove();
		if($(this).hasClass("collapsed")) {
		    var content = $(this).text();
		    var html = $(this).html();

		    if(content.length > 40) {
			if ($.browser.msie) {
			    // We start at '3' to avoid 'tip', as IE
			    // does not count whitespace
			    var content = content.substr(3, 50);
			} else {
			    // We start at '5' to avoid 'tip '
			    var content = content.substr(5, 50);
			}
		    }
		    $(this).html('<p class="summary"><img src="../../_static/plus.png">' + content + '...</p>' + html);
		}
		if (event.target.tagName.toLowerCase() != "a") {
                   return true; //Makes links clickable
		}
	});
    });
    </script>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="auto_examples/index.html" title="3.1.6.1. Examples"
             accesskey="N">下一页</a></li>
        <li class="right" >
          <a href="../index.html" title="3. Packages and applications"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Scipy lecture notes</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">3. Packages and applications</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/jayleicn/scipy-lecture-notes-zh-CN/edit/master/packages/statistics/index.rst">Edit
    <span class="tooltip">
	Improve this page:<br/>Translate/Improve it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="python">
<span id="statistics"></span><h1>3.1. 在Python中进行统计分析<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h1>
<p><strong>Author</strong>: <em>Gaël Varoquaux</em></p>
<div class="topic">
<p class="topic-title first"><strong>Requirements</strong></p>
<ul class="simple">
<li>标准Python科学计算环境 (numpy, scipy, matplotlib)</li>
<li><a class="reference external" href="http://pandas.pydata.org/">Pandas</a></li>
<li><a class="reference external" href="http://statsmodels.sourceforge.net/">Statsmodels</a></li>
<li><a class="reference external" href="http://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a></li>
</ul>
<p>为了安装Python和它的依赖项, 我们推荐你安
装 <a class="reference external" href="http://continuum.io/downloads">Anaconda Python</a> 或者
<a class="reference external" href="https://store.enthought.com/">Enthought Canopy</a>, 或者直接使用包管理器
在 Ubuntu 或其他 linux 系统下工作.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参见</p>
<p><strong>在Python中进行贝叶斯统计分析</strong></p>
<p class="last">这个部分并没有谈及贝叶斯统计. 令人感兴趣的贝叶斯建模相关内容，如 <a class="reference external" href="http://pymc-devs.github.io/pymc">PyMC</a>, 它在Python中实现了概率编程语言.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p><strong>为什么使用Python进行统计分析?</strong></p>
<p class="last">R是一个专门用于统计分析的编程语言。Python则是一个通用编程语言，以
统计相关的模块的方式进行统计分析。R比Python有更多的统计功能，以及对
统计更亲切的语法。无论如何，当建立更复杂的工作流，如与图像分析，文本
挖掘或者物理实验控制集成时，Python的通用性与相关模块就成了无价的财富。</p>
</div>
<div class="contents local topic" id="id1">
<p class="topic-title first">目录</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id36">数据表示与交互方式</a><ul>
<li><a class="reference internal" href="#id3" id="id37">作为表的数据</a></li>
<li><a class="reference internal" href="#pandas-data-frame" id="id38">pandas 的 data-frame</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id39">假设检验: 比较两组情况</a><ul>
<li><a class="reference internal" href="#t" id="id40">t检验:最简单的统计检验</a></li>
<li><a class="reference internal" href="#id15" id="id41">配对检验: 同一个体上重复观测</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18" id="id42">线性模型，多因子与方差分析</a><ul>
<li><a class="reference internal" href="#id19" id="id43">通过公式对象在Python中构建统计模型</a></li>
<li><a class="reference internal" href="#id27" id="id44">多元线性回归</a></li>
<li><a class="reference internal" href="#anova" id="id45">因果假设检验: 方差分析(ANOVA)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id31" id="id46">更强大的可视化: 使用seaborn进行探索式分析</a><ul>
<li><a class="reference internal" href="#id33" id="id47">点对绘图: 散点矩阵</a></li>
<li><a class="reference internal" href="#lmplot" id="id48">lmplot: 绘制单变量回归图</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id35" id="id49">检验交互项</a></li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p>在这个文档中, Python 输入前面有符号&#8221;&gt;&gt;&gt;&#8221;来标识.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>敏感回避: 性别问题</strong></p>
<p class="last">这个教程中的一些例子与性别问题有关。讨论它们是因为在这类问题中的信度
的保证是十分重要的。</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id36">3.1.1. 数据表示与交互方式</a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id37">3.1.1.1. 作为表的数据</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>统计分析中的处理对象为一些 <em>观测</em> 或 <em>样本</em> ，其中每个又以
一些 <em>属性</em> 或 <em>特征</em> 所描述。数据可以看成2维表格或矩阵，它们的列
记录的是数据中不同的属性，而每行则则对应着观测。像这个数据
<a class="reference download internal" href="../../_downloads/brain_size.csv" download=""><code class="xref download docutils literal"><span class="pre">examples/brain_size.csv</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="s2">&quot;Gender&quot;</span><span class="p">;</span><span class="s2">&quot;FSIQ&quot;</span><span class="p">;</span><span class="s2">&quot;VIQ&quot;</span><span class="p">;</span><span class="s2">&quot;PIQ&quot;</span><span class="p">;</span><span class="s2">&quot;Weight&quot;</span><span class="p">;</span><span class="s2">&quot;Height&quot;</span><span class="p">;</span><span class="s2">&quot;MRI_Count&quot;</span>
<div class="newline"></div><span class="s2">&quot;1&quot;</span><span class="p">;</span><span class="s2">&quot;Female&quot;</span><span class="p">;</span><span class="mi">133</span><span class="p">;</span><span class="mi">132</span><span class="p">;</span><span class="mi">124</span><span class="p">;</span><span class="s2">&quot;118&quot;</span><span class="p">;</span><span class="s2">&quot;64.5&quot;</span><span class="p">;</span><span class="mi">816932</span>
<div class="newline"></div><span class="s2">&quot;2&quot;</span><span class="p">;</span><span class="s2">&quot;Male&quot;</span><span class="p">;</span><span class="mi">140</span><span class="p">;</span><span class="mi">150</span><span class="p">;</span><span class="mi">124</span><span class="p">;</span><span class="s2">&quot;.&quot;</span><span class="p">;</span><span class="s2">&quot;72.5&quot;</span><span class="p">;</span><span class="mi">1001121</span>
<div class="newline"></div><span class="s2">&quot;3&quot;</span><span class="p">;</span><span class="s2">&quot;Male&quot;</span><span class="p">;</span><span class="mi">139</span><span class="p">;</span><span class="mi">123</span><span class="p">;</span><span class="mi">150</span><span class="p">;</span><span class="s2">&quot;143&quot;</span><span class="p">;</span><span class="s2">&quot;73.3&quot;</span><span class="p">;</span><span class="mi">1038437</span>
<div class="newline"></div><span class="s2">&quot;4&quot;</span><span class="p">;</span><span class="s2">&quot;Male&quot;</span><span class="p">;</span><span class="mi">133</span><span class="p">;</span><span class="mi">129</span><span class="p">;</span><span class="mi">128</span><span class="p">;</span><span class="s2">&quot;172&quot;</span><span class="p">;</span><span class="s2">&quot;68.8&quot;</span><span class="p">;</span><span class="mi">965353</span>
<div class="newline"></div><span class="s2">&quot;5&quot;</span><span class="p">;</span><span class="s2">&quot;Female&quot;</span><span class="p">;</span><span class="mi">137</span><span class="p">;</span><span class="mi">132</span><span class="p">;</span><span class="mi">134</span><span class="p">;</span><span class="s2">&quot;147&quot;</span><span class="p">;</span><span class="s2">&quot;65.0&quot;</span><span class="p">;</span><span class="mi">951545</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="pandas-data-frame">
<h3><a class="toc-backref" href="#id38">3.1.1.2. pandas 的 data-frame</a><a class="headerlink" href="#pandas-data-frame" title="永久链接至标题">¶</a></h3>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">我们将使用
<a href="#id4"><span class="problematic" id="id5">:class:`pandas.DataFrame`来操作该数据，它是 `pandas
&lt;http://pandas.pydata.org&gt;`_</span></a> 模块的一个类. 这是Python中（Excel那种）电子表格
的等价物。它与二维 <code class="docutils literal"><span class="pre">numpy</span></code> 数组不同，正如其名字所示，它可以包含在各列中
分别保存不同类型的数据，并且提供了精致强大的索引和数据操纵机制。</p>
</div>
<div class="section" id="dataframe">
<h4>3.1.1.2.1. 创建 dataframe: 从文件读取或从数组转换<a class="headerlink" href="#dataframe" title="永久链接至标题">¶</a></h4>
<div class="sidebar">
<p class="first sidebar-title"><strong>分隔符</strong></p>
<p class="last">这是一个CSV文件，虽然它以 &#8221;;&#8221; 作为分隔符而不是 &#8221;,&#8221; 。</p>
</div>
<p><strong>从CSV文件中载入:</strong> 我们将使用上面的CSV文件，该文件给出了一些观测的脑容量，重量与
IQ (Willerman et al. 1991)，这个数据由一些数值型变量与分类变量混合而成:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/brain_size.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>  
<div class="newline"></div><span class="go">    Unnamed: 0  Gender  FSIQ  VIQ  PIQ  Weight  Height  MRI_Count</span>
<div class="newline"></div><span class="go">0            1  Female   133  132  124     118    64.5     816932</span>
<div class="newline"></div><span class="go">1            2    Male   140  150  124     NaN    72.5    1001121</span>
<div class="newline"></div><span class="go">2            3    Male   139  123  150     143    73.3    1038437</span>
<div class="newline"></div><span class="go">3            4    Male   133  129  128     172    68.8     965353</span>
<div class="newline"></div><span class="go">4            5  Female   137  132  134     147    65.0     951545</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p><strong>缺失值</strong></p>
<p class="last">从上面预览中可以看到第二个个体的重量在CSV文件中缺失了。如果我不指派
缺失值（NA = not available）的对应标签，我们将不能继续进行统计分析。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>从数组中创建</strong>: 类 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html#pandas.DataFrame" title="(在 pandas v0.19.2)"><code class="xref py py-class docutils literal"><span class="pre">pandas.DataFrame</span></code></a> 可以看成是1维的 &#8216;series&#8217;
对象（如 arrays 或 lists 等）的字典。 譬如，我们有三个 <code class="docutils literal"><span class="pre">numpy</span></code> arrays:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">sin_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">cos_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>我们可以把它们装进一个 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html#pandas.DataFrame" title="(在 pandas v0.19.2)"><code class="xref py py-class docutils literal"><span class="pre">pandas.DataFrame</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span> <span class="s1">&#39;sin&#39;</span><span class="p">:</span> <span class="n">sin_t</span><span class="p">,</span> <span class="s1">&#39;cos&#39;</span><span class="p">:</span> <span class="n">cos_t</span><span class="p">})</span>  
<div class="newline"></div><span class="go">         cos       sin         t</span>
<div class="newline"></div><span class="go">0   0.960170  0.279415 -6.000000</span>
<div class="newline"></div><span class="go">1   0.609977  0.792419 -5.368421</span>
<div class="newline"></div><span class="go">2   0.024451  0.999701 -4.736842</span>
<div class="newline"></div><span class="go">3  -0.570509  0.821291 -4.105263</span>
<div class="newline"></div><span class="go">4  -0.945363  0.326021 -3.473684</span>
<div class="newline"></div><span class="go">5  -0.955488 -0.295030 -2.842105</span>
<div class="newline"></div><span class="go">6  -0.596979 -0.802257 -2.210526</span>
<div class="newline"></div><span class="go">7  -0.008151 -0.999967 -1.578947</span>
<div class="newline"></div><span class="go">8   0.583822 -0.811882 -0.947368</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div></pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>其他输入方式</strong>: <a class="reference external" href="http://pandas.pydata.org">pandas</a> 可以从
SQL, excel 文件, 或其他格式这种导入数据. 参见 <a class="reference external" href="http://pandas.pydata.org">pandas文档</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id8">
<h4>3.1.1.2.2. 操纵数据<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<p><cite>data</cite> 是一个 <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html#pandas.DataFrame" title="(在 pandas v0.19.2)"><code class="xref py py-class docutils literal"><span class="pre">pandas.DataFrame</span></code></a> 对象, 它与 R的 dataframe 对象很类似:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>    <span class="c1"># 40 rows and 8 columns</span>
<div class="newline"></div><span class="go">(40, 8)</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>  <span class="c1"># It has columns   </span>
<div class="newline"></div><span class="go">Index([u&#39;Unnamed: 0&#39;, u&#39;Gender&#39;, u&#39;FSIQ&#39;, u&#39;VIQ&#39;, u&#39;PIQ&#39;, u&#39;Weight&#39;, u&#39;Height&#39;, u&#39;MRI_Count&#39;], dtype=&#39;object&#39;)</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">])</span>  <span class="c1"># Columns can be addressed by name   </span>
<div class="newline"></div><span class="go">0     Female</span>
<div class="newline"></div><span class="go">1       Male</span>
<div class="newline"></div><span class="go">2       Male</span>
<div class="newline"></div><span class="go">3       Male</span>
<div class="newline"></div><span class="go">4     Female</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simpler selector</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Female&#39;</span><span class="p">][</span><span class="s1">&#39;VIQ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<div class="newline"></div><span class="go">109.45</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">为了快速得到dataframe数据的大致状况, 使用它的 <cite>describe</cite>
方法: <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.describe.html#pandas.DataFrame.describe" title="(在 pandas v0.19.2)"><code class="xref py py-meth docutils literal"><span class="pre">pandas.DataFrame.describe()</span></code></a>.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>groupby</strong>: 以分类变量的值分隔数据:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">groupby_gender</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">gender</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">groupby_gender</span><span class="p">[</span><span class="s1">&#39;VIQ&#39;</span><span class="p">]:</span>
<div class="newline"></div><span class="gp">... </span>    <span class="nb">print</span><span class="p">((</span><span class="n">gender</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
<div class="newline"></div><span class="go">(&#39;Female&#39;, 109.45)</span>
<div class="newline"></div><span class="go">(&#39;Male&#39;, 115.25)</span>
<div class="newline"></div></pre></div>
</div>
<p><cite>groupby_gender</cite> 是一个有着很多强大汇总函数方法的对象，可以分别加在各分组上:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">groupby_gender</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<div class="newline"></div><span class="go">        Unnamed: 0   FSIQ     VIQ     PIQ      Weight     Height  MRI_Count</span>
<div class="newline"></div><span class="go">Gender</span>
<div class="newline"></div><span class="go">Female       19.65  111.9  109.45  110.45  137.200000  65.765000   862654.6</span>
<div class="newline"></div><span class="go">Male         21.35  115.0  115.25  111.60  166.444444  71.431579   954855.4</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">对`groupby_gender`对象使用tab自动补全来找到类似这样的函数。其中常用的
有median, count（对于检查不同子集中的缺失值数量有用）或sum。这里分组操作
是惰性求值的，在实际调用任何汇总函数之前并不引发任何复制或运算。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference external image-reference" href="auto_examples/plot_pandas.html"><img alt="../../_images/plot_pandas_1.png" class="align-right" src="../../_images/plot_pandas_1.png" style="width: 336.0px; height: 252.0px;" /></a>
<div class="green topic">
<p class="topic-title first"><strong>练习</strong></p>
<ul>
<li><p class="first">全部样本的VIQ均值是多少？</p>
</li>
<li><p class="first">在这个研究中有多少男性/女性被包含在内？</p>
<p><strong>提示</strong> 使用 &#8216;tab自动补全&#8217; 来找到可以调用的方法，替换上面调用的&#8217;mean&#8217;的地位
达到效果。</p>
</li>
<li><p class="first">log变换后的MRI count指标在男性与女性中的平均值各为多少?</p>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><cite>groupby_gender.boxplot</cite> 可以用于以图形形式回答这个问题 (see <a class="reference internal" href="auto_examples/plot_pandas.html#example-plot-pandas-py"><span class="std std-ref">this
example</span></a>).</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id9">
<h4>3.1.1.2.3. 数据可视化<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<p>Pandas 有一些绘图方法 (<code class="xref py py-mod docutils literal"><span class="pre">pandas.tools.plotting</span></code>, 这里基于matplotlib) 显示
dataframe中的统计量。</p>
<p><strong>散点矩阵</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pandas.tools</span> <span class="k">import</span> <span class="n">plotting</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Weight&#39;</span><span class="p">,</span> <span class="s1">&#39;Height&#39;</span><span class="p">,</span> <span class="s1">&#39;MRI_Count&#39;</span><span class="p">]])</span>   
<div class="newline"></div></pre></div>
</div>
<a class="reference external image-reference" href="auto_examples/plot_pandas.html"><img alt="../../_images/plot_pandas_2.png" class="align-center" src="../../_images/plot_pandas_2.png" style="width: 560.0px; height: 420.0px;" /></a>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">,</span> <span class="s1">&#39;VIQ&#39;</span><span class="p">,</span> <span class="s1">&#39;FSIQ&#39;</span><span class="p">]])</span>   
<div class="newline"></div></pre></div>
</div>
<div class="sidebar">
<p class="first sidebar-title"><strong>双总体</strong></p>
<p class="last">IQ指标呈现了双峰（bimodal），这是因为这里有两个子总体。</p>
</div>
<a class="reference external image-reference" href="auto_examples/plot_pandas.html"><img alt="../../_images/plot_pandas_3.png" class="align-center" src="../../_images/plot_pandas_3.png" style="width: 560.0px; height: 420.0px;" /></a>
<div class="green topic">
<p class="topic-title first"><strong>练习</strong></p>
<p>分别绘制只包含男性与女性的散点矩阵。你认为这两个子总体符合性别情况吗？</p>
</div>
</div>
</div>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id39">3.1.2. 假设检验: 比较两组情况</a><a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<p>对于简单的 <a class="reference external" href="https://en.wikipedia.org/wiki/Statistical_hypothesis_testing">假设检验</a>, 我们将
使用  <a class="reference external" href="http://docs.scipy.org/doc/">scipy</a> 模块的 <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/stats.html#module-scipy.stats" title="(在 SciPy v0.19.0)"><code class="xref py py-mod docutils literal"><span class="pre">scipy.stats</span></code></a> 子模块:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参见</p>
<p class="last">Scipy is a vast library. For a quick summary to the whole library, see
the <a class="reference internal" href="../../intro/scipy.html#scipy"><span class="std std-ref">scipy</span></a> chapter.
Scipy是一个庞大的库。若想获得该库的一个概览，
参见 <a class="reference internal" href="../../intro/scipy.html#scipy"><span class="std std-ref">scipy</span></a> 章节。</p>
</div>
<div class="section" id="t">
<h3><a class="toc-backref" href="#id40">3.1.2.1. t检验:最简单的统计检验</a><a class="headerlink" href="#t" title="永久链接至标题">¶</a></h3>
<div class="section" id="id12">
<h4>3.1.2.1.1. 单样本那t检验: 检验总体均值<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<a class="reference internal image-reference" href="../../_images/two_sided.png"><img alt="../../_images/two_sided.png" class="align-right" src="../../_images/two_sided.png" style="width: 228.5px; height: 223.5px;" /></a>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_1samp.html#scipy.stats.ttest_1samp" title="(在 SciPy v0.19.0)"><code class="xref py py-func docutils literal"><span class="pre">scipy.stats.ttest_1samp()</span></code></a> 检验给定值是否可能是数据的均值（严格的说，是
检验是否数据是从符合给定值为期望的正态分布中抽取出来的。）。它返回
所谓的 <a class="reference external" href="https://en.wikipedia.org/wiki/Student%27s_t-test">T统计量</a>,
与 <a class="reference external" href="https://en.wikipedia.org/wiki/P-value">p值</a> （参见函数文档）。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;VIQ&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>   
<div class="newline"></div><span class="go">(...30.088099970..., 1.32891964...e-28)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">由于p值为 10^-28，我们可以断言IQ（以VIQ度量）均值不为0.</p>
</div>
</div>
<div class="section" id="id14">
<h4>3.1.2.1.2. 双样本t检验: 检验两个样本之间的差异<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<p>我们之前已经看到男性与女性的VIQ均值是不一样的，为了检验这个差异是否显著，
我们进行双样本t检验，可以调用函数 <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_ind.html#scipy.stats.ttest_ind" title="(在 SciPy v0.19.0)"><code class="xref py py-func docutils literal"><span class="pre">scipy.stats.ttest_ind()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">female_viq</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Female&#39;</span><span class="p">][</span><span class="s1">&#39;VIQ&#39;</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">male_viq</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Male&#39;</span><span class="p">][</span><span class="s1">&#39;VIQ&#39;</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">female_viq</span><span class="p">,</span> <span class="n">male_viq</span><span class="p">)</span>   
<div class="newline"></div><span class="go">(...-0.77261617232..., 0.4445287677858...)</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id41">3.1.2.2. 配对检验: 同一个体上重复观测</a><a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<a class="reference external image-reference" href="auto_examples/plot_pandas.html"><img alt="../../_images/plot_paired_boxplots_1.png" class="align-right" src="../../_images/plot_paired_boxplots_1.png" style="width: 280.0px; height: 210.0px;" /></a>
<p>PIQ, VIQ 与 FSIQ 给出了IQ的三种测量方式。让我们检验是否FISQ与PIQ是有显著差异
的。我们可以使用双样本t检验:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FSIQ&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">])</span>   
<div class="newline"></div><span class="go">(...0.46563759638..., 0.64277250...)</span>
<div class="newline"></div></pre></div>
</div>
<p>这个方法的问题在于它丢弃了每个FSIQ，PIQ对是通过对相同个体进行测量得到的这一信息。
所以就高估了统计量的标准差，使得检验更难被拒绝，这一步可以使用&#8221;配对检验&#8221;或&#8221;重复观测检验&#8221;
得到矫正 &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Repeated_measures_design">https://en.wikipedia.org/wiki/Repeated_measures_design</a>&gt;`_:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_rel</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FSIQ&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">])</span>   
<div class="newline"></div><span class="go">(...1.784201940..., 0.082172638183...)</span>
<div class="newline"></div></pre></div>
</div>
<a class="reference external image-reference" href="auto_examples/plot_pandas.html"><img alt="../../_images/plot_paired_boxplots_2.png" class="align-right" src="../../_images/plot_paired_boxplots_2.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>这与两者差分的0均值单样本t检验等价:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FSIQ&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>   
<div class="newline"></div><span class="go">(...1.784201940..., 0.082172638...)</span>
<div class="newline"></div></pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>T-检验假定了数据服从正态分布，我们可以使用 <a href="#id16"><span class="problematic" id="id17">`</span></a>Wilcoxon符号秩检验
&lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test">https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test</a>&gt;`_来放松这个假设。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FSIQ&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">])</span>   
<div class="newline"></div><span class="go">(274.5, 0.106594927...)</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">类似的非配对非参数检验方法是 <a class="reference external" href="https://en.wikipedia.org/wiki/Mann%E2%80%93Whitney_U">Mann-Whitney U 检
验</a>,
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.mannwhitneyu.html#scipy.stats.mannwhitneyu" title="(在 SciPy v0.19.0)"><code class="xref py py-func docutils literal"><span class="pre">scipy.stats.mannwhitneyu()</span></code></a>.</p>
</div>
<div class="green topic">
<p class="topic-title first"><strong>练习</strong></p>
<ul class="simple">
<li>检验男性与女性间重量的差异</li>
<li>使用非参数统计量检验VIQ在男性与女性间的差异。</li>
</ul>
<p><strong>总结</strong>: 我们发现数据并不支持男性与女性在VIQ间有差别的假设。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id42">3.1.3. 线性模型，多因子与方差分析</a><a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<div class="section" id="id19">
<h3><a class="toc-backref" href="#id43">3.1.3.1. 通过公式对象在Python中构建统计模型</a><a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h3>
<div class="section" id="id20">
<h4>3.1.3.1.1. 简单线性回归的例子<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h4>
<a class="reference external image-reference" href="auto_examples/plot_regression.html"><img alt="../../_images/plot_regression_1.png" class="align-right" src="../../_images/plot_regression_1.png" style="width: 300.0px; height: 240.0px;" /></a>
<p>给定观测的两个维度,`x`与`y`，我们想要检验`y`是否是`x`的一个线性函数的假设。
换句话说:</p>
<blockquote>
<div><img class="math" src="../../_images/math/bc58ea9036de1e62198871a091359876bff43a5b.png" alt="y = x * coef + intercept + e" style="vertical-align: -6px"/></div></blockquote>
<p>其中 <cite>e</cite> 是噪声项。我们将使用 <a class="reference external" href="http://statsmodels.sourceforge.net/">statmodels</a> 模块来:</p>
<ol class="arabic simple">
<li>拟合一个线性模型，我们将使用最简单的方法, <a class="reference external" href="https://en.wikipedia.org/wiki/Ordinary_least_squares">最小二乘
法</a> (OLS).</li>
<li>检验 <cite>coef</cite> 是非0向量的假设.</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>首先，我们为模型生成一些模拟数据:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="c1"># normal distributed noise</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a data frame containing all the relevant variables</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>
<div class="newline"></div></pre></div>
</div>
<div class="sidebar">
<p class="first sidebar-title"><strong>在Python中使用统计公式</strong></p>
<p class="last"><a class="reference external" href="http://statsmodels.sourceforge.net/stable/example_formulas.html">见statsmodels的文档</a></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>接着我们指定一个OLS模型，然后拟合它:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="k">import</span> <span class="n">ols</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s2">&quot;y ~ x&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<p>我们可以查看从拟合中得到的各个统计量:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>  
<div class="newline"></div><span class="go">                            OLS Regression Results</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">Dep. Variable:                      y   R-squared:                       0.804</span>
<div class="newline"></div><span class="go">Model:                            OLS   Adj. R-squared:                  0.794</span>
<div class="newline"></div><span class="go">Method:                 Least Squares   F-statistic:                     74.03</span>
<div class="newline"></div><span class="go">Date:                ...                Prob (F-statistic):           8.56e-08</span>
<div class="newline"></div><span class="go">Time:                        ...        Log-Likelihood:                -57.988</span>
<div class="newline"></div><span class="go">No. Observations:                  20   AIC:                             120.0</span>
<div class="newline"></div><span class="go">Df Residuals:                      18   BIC:                             122.0</span>
<div class="newline"></div><span class="go">Df Model:                           1</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">                 coef    std err          t      P&gt;|t|      [95.0% Conf. Int.]</span>
<div class="newline"></div><span class="go">------------------------------------------...</span>
<div class="newline"></div><span class="go">Intercept     -5.5335      1.036     -5.342      0.000        -7.710    -3.357</span>
<div class="newline"></div><span class="go">x              2.9369      0.341      8.604      0.000         2.220     3.654</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">Omnibus:                        0.100   Durbin-Watson:                   2.956</span>
<div class="newline"></div><span class="go">Prob(Omnibus):                  0.951   Jarque-Bera (JB):                0.322</span>
<div class="newline"></div><span class="go">Skew:                          -0.058   Prob(JB):                        0.851</span>
<div class="newline"></div><span class="go">Kurtosis:                       2.390   Cond. No.                         3.03</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div></pre></div>
</div>
<div class="topic">
<p class="topic-title first">术语:</p>
<p>Statsmodel 使用一些统计术语，比如`y`变量在statsmodel里被称为`endogenous`
而`x`变量则被称为exogenous。更多细节参见 <a class="reference external" href="http://statsmodels.sourceforge.net/devel/endog_exog.html">这里</a>.</p>
<p>作为简化, <a href="#id24"><span class="problematic" id="id25">`</span></a>y`(endogenous) 可以看成你打算预测的值，而`x`(exogenous)则表示
你打算用来进行预测时凭借的变量。</p>
</div>
<div class="green topic">
<p class="topic-title first"><strong>练习</strong></p>
<p>用变量保存上面模型估计中所展示的参数。<strong>提示</strong>:
使用tab补全找到相关属性。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="id26">
<h4>3.1.3.1.2. 分类变量: 比较分组或多个分类情况<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h4>
<p>让我们回到大脑大小的例子中:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/brain_size.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>我们可以做一个线性模型来比较男性与女性的IQ差别:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s2">&quot;VIQ ~ Gender + 1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>  
<div class="newline"></div><span class="go">                            OLS Regression Results</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">Dep. Variable:                    VIQ   R-squared:                       0.015</span>
<div class="newline"></div><span class="go">Model:                            OLS   Adj. R-squared:                 -0.010</span>
<div class="newline"></div><span class="go">Method:                 Least Squares   F-statistic:                    0.5969</span>
<div class="newline"></div><span class="go">Date:                ...                Prob (F-statistic):              0.445</span>
<div class="newline"></div><span class="go">Time:                        ...        Log-Likelihood:                -182.42</span>
<div class="newline"></div><span class="go">No. Observations:                  40   AIC:                             368.8</span>
<div class="newline"></div><span class="go">Df Residuals:                      38   BIC:                             372.2</span>
<div class="newline"></div><span class="go">Df Model:                           1</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">                  coef    std err        t      P&gt;|t|      [95.0% Conf. Int.]</span>
<div class="newline"></div><span class="go">-----------------------------------------------------------------------...</span>
<div class="newline"></div><span class="go">Intercept        109.4500     5.308     20.619     0.000      98.704   120.196</span>
<div class="newline"></div><span class="go">Gender[T.Male]     5.8000     7.507      0.773     0.445      -9.397    20.997</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">Omnibus:                       26.188   Durbin-Watson:                   1.709</span>
<div class="newline"></div><span class="go">Prob(Omnibus):                  0.000   Jarque-Bera (JB):                3.703</span>
<div class="newline"></div><span class="go">Skew:                           0.010   Prob(JB):                        0.157</span>
<div class="newline"></div><span class="go">Kurtosis:                       1.510   Cond. No.                         2.62</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div></pre></div>
</div>
<div class="topic">
<p class="topic-title first"><strong>构建模型的技巧</strong></p>
<p><strong>强制分类变量化</strong>: &#8216;Gender&#8217; 被自动发现是一个分类变量，然后它的每个
取值被处理成不同的实体。</p>
<p>一个只有整数的数据列可以以这样的方式被强制解释为分类变量:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;VIQ ~ C(Gender)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>截距</strong>: 我们可以利用在公式中使用 <cite>- 1</cite> 来删除模型中的截距,
也可以使用 <cite>+ 1</cite> 来强制使用截距.</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">默认情况下,statsmodel 将K个取值（或称为&#8221;水平&#8221;）的分类变量以 K-1个
虚拟变量编码（最后一个水平被吸进截距项中）。作为默认项这个处理方法不坏，
但也可以指定其他的分类变量编码方法，见
(<a class="reference external" href="http://statsmodels.sourceforge.net/devel/contrasts.html">http://statsmodels.sourceforge.net/devel/contrasts.html</a>).</p>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="topic">
<p class="topic-title first"><strong>与FSIQ与PIQ的t检验的联系</strong></p>
<p>为了比较不同类型的IQ，我们需要创建一个 &#8220;长式表&#8221;(&#8220;long-form&#8221; talbe)
，其中不同种类的IQ被放入同一列中，其类型被同行的另一个分类变量编码:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_fisq</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;iq&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FSIQ&#39;</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;fsiq&#39;</span><span class="p">})</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data_piq</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;iq&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;piq&#39;</span><span class="p">})</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">data_long</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data_fisq</span><span class="p">,</span> <span class="n">data_piq</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data_long</span><span class="p">)</span>  
<div class="newline"></div><span class="go">         iq  type</span>
<div class="newline"></div><span class="go">    0   133  fsiq</span>
<div class="newline"></div><span class="go">    1   140  fsiq</span>
<div class="newline"></div><span class="go">    2   139  fsiq</span>
<div class="newline"></div><span class="go">    ...</span>
<div class="newline"></div><span class="go">    31  137   piq</span>
<div class="newline"></div><span class="go">    32  110   piq</span>
<div class="newline"></div><span class="go">    33   86   piq</span>
<div class="newline"></div><span class="go">    ...</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s2">&quot;iq ~ type&quot;</span><span class="p">,</span> <span class="n">data_long</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>  
<div class="newline"></div><span class="go">                            OLS Regression Results</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">                 coef    std err          t      P&gt;|t|      [95.0% Conf. Int.]</span>
<div class="newline"></div><span class="go">------------------------------------------...</span>
<div class="newline"></div><span class="go">Intercept     113.4500      3.683     30.807      0.000       106.119   120.781</span>
<div class="newline"></div><span class="go">type[T.piq]    -2.4250      5.208     -0.466      0.643       -12.793     7.943</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div></pre></div>
</div>
<p>我们可以发现这与上面对应比较IQ的t检验取得了相同的统计量值与p值:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FSIQ&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PIQ&#39;</span><span class="p">])</span>   
<div class="newline"></div><span class="go">(...0.46563759638..., 0.64277250...)</span>
<div class="newline"></div></pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id27">
<h3><a class="toc-backref" href="#id44">3.1.3.2. 多元线性回归</a><a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h3>
<a class="reference external image-reference" href="auto_examples/plot_regression_3d.html"><img alt="../../_images/plot_regression_3d_1.png" class="align-right" src="../../_images/plot_regression_3d_1.png" style="width: 360.0px; height: 270.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>考虑一个解释因变量`z`的线性模型，它有两个自变量`x`与`y`:</p>
<blockquote>
<div><img class="math" src="../../_images/math/cddc472fb39acbaeda699510793607c1defe17b2.png" alt="z = x \, c_1 + y \, c_2 + i + e" style="vertical-align: -6px"/></div></blockquote>
<p>这样一个模型可以在3D空间中被可视化为一个平面嵌入到(<cite>x</cite>,`y`,`z`)构成的散点云中。</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p><strong>实例: iris数据集</strong> (<a class="reference download internal" href="../../_downloads/iris.csv" download=""><code class="xref download docutils literal"><span class="pre">examples/iris.csv</span></code></a>)</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">sepal(萼片)与petal(花瓣)大小看上去是相关的: 其中一者较大时另一者也较大！
但是在各族间存在进一步的系统差异吗？</p>
</div>
<a class="reference external image-reference" href="auto_examples/plot_iris_analysis_1.html"><img alt="../../_images/plot_iris_analysis_1.png" class="align-center" src="../../_images/plot_iris_analysis_1.png" style="width: 640.0px; height: 480.0px;" /></a>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/iris.csv&#39;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;sepal_width ~ name + petal_length&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>  
<div class="newline"></div><span class="go">                            OLS Regression Results</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">Dep. Variable:            sepal_width   R-squared:                       0.478</span>
<div class="newline"></div><span class="go">Model:                            OLS   Adj. R-squared:                  0.468</span>
<div class="newline"></div><span class="go">Method:                 Least Squares   F-statistic:                     44.63</span>
<div class="newline"></div><span class="go">Date:                ...                Prob (F-statistic):           1.58e-20</span>
<div class="newline"></div><span class="go">Time:                        ...        Log-Likelihood:                -38.185</span>
<div class="newline"></div><span class="go">No. Observations:                 150   AIC:                             84.37</span>
<div class="newline"></div><span class="go">Df Residuals:                     146   BIC:                             96.41</span>
<div class="newline"></div><span class="go">Df Model:                           3</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">                         coef    std err          t     P&gt;|t|  [95.0% Conf. Int.]</span>
<div class="newline"></div><span class="go">------------------------------------------...</span>
<div class="newline"></div><span class="go">Intercept              2.9813      0.099     29.989     0.000      2.785     3.178</span>
<div class="newline"></div><span class="go">name[T.versicolor]    -1.4821      0.181     -8.190     0.000     -1.840    -1.124</span>
<div class="newline"></div><span class="go">name[T.virginica]     -1.6635      0.256     -6.502     0.000     -2.169    -1.158</span>
<div class="newline"></div><span class="go">petal_length           0.2983      0.061      4.920     0.000      0.178     0.418</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="go">Omnibus:                        2.868   Durbin-Watson:                   1.753</span>
<div class="newline"></div><span class="go">Prob(Omnibus):                  0.238   Jarque-Bera (JB):                2.885</span>
<div class="newline"></div><span class="go">Skew:                          -0.082   Prob(JB):                        0.236</span>
<div class="newline"></div><span class="go">Kurtosis:                       3.659   Cond. No.                         54.0</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div></pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="anova">
<h3><a class="toc-backref" href="#id45">3.1.3.3. 因果假设检验: 方差分析(ANOVA)</a><a class="headerlink" href="#anova" title="永久链接至标题">¶</a></h3>
<p>在上面的iris例子中，我们希望检验是否petal长度在versicolor与virginica类中有差异，
在控制了sepal宽度的效应后。这可以公式化为检验模型中versicolor与virginica的系数
是否存在差别。（这是所谓的方差分析 <a class="reference external" href="https://en.wikipedia.org/wiki/Analysis_of_variance">ANOVA</a>). 为了做到这一点，我们
比照被估计的参数额顺序写了一个 <strong>比较向量</strong>，我们想要以 <a class="reference external" href="https://en.wikipedia.org/wiki/F-test">F检验</a> 检验假设``&#8221;name[T.versicolor] - name[T.virginica]&#8221;<a href="#id29"><span class="problematic" id="id30">``</span></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">f_test</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
<div class="newline"></div><span class="go">&lt;F test: F=array([[ 3.24533535]]), p=[[ 0.07369059]], df_denom=146, df_num=1&gt;</span>
<div class="newline"></div></pre></div>
</div>
<p>所以是否有显著差异呢?
|</p>
<div class="green topic">
<p class="topic-title first"><strong>练习</strong></p>
<p>回到IQ数据上来，检验是否男性/女性的VIQ在控制了脑大小,高度与重量后
会有差异。</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id31">
<h2><a class="toc-backref" href="#id46">3.1.4. 更强大的可视化: 使用seaborn进行探索式分析</a><a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="http://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a> 在pandas dataframe
上组合了简单的统计量拟合与绘图。</p>
<p>让我们考虑一个给定了工资与其他个人信息的数据，其由500个个体组成。
(<a class="reference external" href="http://lib.stat.cmu.edu/datasets/CPS_85_Wages">Berndt, ER. The Practice of Econometrics. 1991. NY:
Addison-Wesley</a>).</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">包括载入数据与绘图的完整代码参见
<a class="reference internal" href="auto_examples/plot_wage_data.html#example-plot-wage-data-py"><span class="std std-ref">corresponding example</span></a>.</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">data</span>  
<div class="newline"></div><span class="go">     EDUCATION  SOUTH  SEX  EXPERIENCE  UNION      WAGE  AGE  RACE  \</span>
<div class="newline"></div><span class="go">0            8      0    1          21      0  0.707570   35     2</span>
<div class="newline"></div><span class="go">1            9      0    1          42      0  0.694605   57     3</span>
<div class="newline"></div><span class="go">2           12      0    0           1      0  0.824126   19     3</span>
<div class="newline"></div><span class="go">3           12      0    0           4      0  0.602060   22     3</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div></pre></div>
</div>
<div class="section" id="id33">
<h3><a class="toc-backref" href="#id47">3.1.4.1. 点对绘图: 散点矩阵</a><a class="headerlink" href="#id33" title="永久链接至标题">¶</a></h3>
<p>我们可以使用 <a class="reference external" href="http://seaborn.pydata.org/generated/seaborn.pairplot.html#seaborn.pairplot" title="(在 seaborn v0.7.1)"><code class="xref py py-func docutils literal"><span class="pre">seaborn.pairplot()</span></code></a> 画出一个散点矩阵来获取各个连续变量
之间的关系。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">seaborn</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">seaborn</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="s1">&#39;EDUCATION&#39;</span><span class="p">],</span>
<div class="newline"></div><span class="gp">... </span>                 <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;reg&#39;</span><span class="p">)</span>  
<div class="newline"></div></pre></div>
</div>
<a class="reference external image-reference" href="auto_examples/plot_wage_data.html"><img alt="../../_images/plot_wage_data_1.png" class="align-center" src="../../_images/plot_wage_data_1.png" style="width: 450.0px; height: 450.0px;" /></a>
<p>分类变量可以这样绘制</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">seaborn</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="s1">&#39;EDUCATION&#39;</span><span class="p">],</span>
<div class="newline"></div><span class="gp">... </span>                 <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;reg&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;SEX&#39;</span><span class="p">)</span>  
<div class="newline"></div></pre></div>
</div>
<a class="reference external image-reference" href="auto_examples/plot_wage_data.html"><img alt="../../_images/plot_wage_data_2.png" class="align-center" src="../../_images/plot_wage_data_2.png" style="width: 500.4px; height: 450.0px;" /></a>
<div class="topic">
<p class="topic-title first"><strong>关于matplotlib的设定</strong></p>
<p>Seaborn 改变了matplotlib图像的默认设定产生更&#8221;现代&#8221;，&#8221;像excel&#8221;的图像外观。
它在导入时就这么做了，你可以重置为默认设定通过:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">为了又切回seaborn的设定，或者了解更多关于seaborn的样式设定，
见 <a class="reference external" href="http://stanford.edu/~mwaskom/software/seaborn/tutorial/aesthetics.html">seaborn文档的相关章节</a>.</p>
</div>
</div>
</div>
<div class="section" id="lmplot">
<h3><a class="toc-backref" href="#id48">3.1.4.2. lmplot: 绘制单变量回归图</a><a class="headerlink" href="#lmplot" title="永久链接至标题">¶</a></h3>
<p>回归捕捉了两个变量之间的联系，如工资与教育水平之间，可以使用 <a class="reference external" href="http://seaborn.pydata.org/generated/seaborn.lmplot.html#seaborn.lmplot" title="(在 seaborn v0.7.1)"><code class="xref py py-func docutils literal"><span class="pre">seaborn.lmplot()</span></code></a>
显示出两者联系:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">seaborn</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;WAGE&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;EDUCATION&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  
<div class="newline"></div></pre></div>
</div>
<a class="reference external image-reference" href="auto_examples/plot_wage_data.html"><img alt="../../_images/plot_wage_data_5.png" class="align-center" src="../../_images/plot_wage_data_5.png" style="width: 300.0px; height: 300.0px;" /></a>
<div class="topic">
<p class="topic-title first"><strong>Robust regression</strong></p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">从上面的图像中可以看到似乎有一些点偏离了散点云而较偏右，它们也许是离群点，
对总体不具有代表性，但却主导了回归。</p>
</div>
<p>为了进行对离群点不那么敏感的回归，必须使用 <a class="reference external" href="https://en.wikipedia.org/wiki/Robust_statistics">robust model</a>. 这在seaborn中
通过在上面那个函数中指定 <code class="docutils literal"><span class="pre">robust=True</span></code> 实现。或者在statsmodels中将OLS
换为&#8221;Robust Linear Model&#8221; <code class="xref py py-func docutils literal"><span class="pre">statsmodels.formula.api.rlm()</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="id35">
<h2><a class="toc-backref" href="#id49">3.1.5. 检验交互项</a><a class="headerlink" href="#id35" title="永久链接至标题">¶</a></h2>
<a class="reference external image-reference" href="auto_examples/plot_wage_education_gender.html"><img alt="../../_images/plot_wage_education_gender_1.png" class="align-center" src="../../_images/plot_wage_education_gender_1.png" style="width: 355.2px; height: 300.0px;" /></a>
<p>是否男性的工资增长对教育更敏感？</p>
<div class="admonition tip">
<p class="first admonition-title">小技巧</p>
<p class="last">&lt;<a class="reference external" href="http://statsmodels.sourceforge.net/devel/example_formulas.html#multiplicative-interactions">http://statsmodels.sourceforge.net/devel/example_formulas.html#multiplicative-interactions</a>&gt;`_.
上面的图片是以两个不同的拟合生成的，但我们想要把斜率变化放在一个公式里表达，
这可以通过向模型中添加交互项解决。</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;wage ~ education + gender + education * gender&#39;</span><span class="p">,</span>
<div class="newline"></div><span class="gp">... </span>                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>    
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>    
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div><span class="go">                            coef    std err    t     P&gt;|t|  [95.0% Conf. Int.]</span>
<div class="newline"></div><span class="go">------------------------------------------------------------------------------</span>
<div class="newline"></div><span class="go">Intercept                   0.2998   0.072    4.173   0.000     0.159   0.441</span>
<div class="newline"></div><span class="go">gender[T.male]              0.2750   0.093    2.972   0.003     0.093   0.457</span>
<div class="newline"></div><span class="go">education                   0.0415   0.005    7.647   0.000     0.031   0.052</span>
<div class="newline"></div><span class="go">education:gender[T.male]   -0.0134   0.007   -1.919   0.056    -0.027   0.000</span>
<div class="newline"></div><span class="go">==========================...</span>
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div></pre></div>
</div>
<p>我们可以得出在教育中男性比女性受益更多的结论吗？</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="topic">
<p class="topic-title first"><strong>一些有用的信息</strong></p>
<ul class="simple">
<li>假设检验的p值告诉你效应/差异的**显著性**。</li>
<li>带分类变量的公式让你可以表达数据中复杂的联系。</li>
<li>可视化你的数据与简单模型很有用！</li>
<li>寻找有意义的自变量是建模中重要的一步，它影响最后的解释。</li>
</ul>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><div style="clear: both"></div></p>
</div>
<div class="section" id="full-examples">
<h2>3.1.6. Full examples<a class="headerlink" href="#full-examples" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="auto_examples/index.html">3.1.6.1. Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/index.html#code-examples">3.1.6.1.1. Code examples</a><ul>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/index.html#solutions-to-the-exercises-of-the-course">3.1.6.1.2. Solutions to the exercises of the course</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
	<div class="sidebartoc">
  <h3><a href="../../index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.1. 在Python中进行统计分析</a><ul>
<li><a class="reference internal" href="#id2">3.1.1. 数据表示与交互方式</a><ul>
<li><a class="reference internal" href="#id3">3.1.1.1. 作为表的数据</a></li>
<li><a class="reference internal" href="#pandas-data-frame">3.1.1.2. pandas 的 data-frame</a><ul>
<li><a class="reference internal" href="#dataframe">3.1.1.2.1. 创建 dataframe: 从文件读取或从数组转换</a></li>
<li><a class="reference internal" href="#id8">3.1.1.2.2. 操纵数据</a></li>
<li><a class="reference internal" href="#id9">3.1.1.2.3. 数据可视化</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id10">3.1.2. 假设检验: 比较两组情况</a><ul>
<li><a class="reference internal" href="#t">3.1.2.1. t检验:最简单的统计检验</a><ul>
<li><a class="reference internal" href="#id12">3.1.2.1.1. 单样本那t检验: 检验总体均值</a></li>
<li><a class="reference internal" href="#id14">3.1.2.1.2. 双样本t检验: 检验两个样本之间的差异</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">3.1.2.2. 配对检验: 同一个体上重复观测</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">3.1.3. 线性模型，多因子与方差分析</a><ul>
<li><a class="reference internal" href="#id19">3.1.3.1. 通过公式对象在Python中构建统计模型</a><ul>
<li><a class="reference internal" href="#id20">3.1.3.1.1. 简单线性回归的例子</a></li>
<li><a class="reference internal" href="#id26">3.1.3.1.2. 分类变量: 比较分组或多个分类情况</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id27">3.1.3.2. 多元线性回归</a></li>
<li><a class="reference internal" href="#anova">3.1.3.3. 因果假设检验: 方差分析(ANOVA)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id31">3.1.4. 更强大的可视化: 使用seaborn进行探索式分析</a><ul>
<li><a class="reference internal" href="#id33">3.1.4.1. 点对绘图: 散点矩阵</a></li>
<li><a class="reference internal" href="#lmplot">3.1.4.2. lmplot: 绘制单变量回归图</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id35">3.1.5. 检验交互项</a></li>
<li><a class="reference internal" href="#full-examples">3.1.6. Full examples</a></li>
</ul>
</li>
</ul>
</div>



    <div class="script_container">
    <script>
    (function() {
	var cx = '004523248466141510607:hgv2yimrahw';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
	    '//cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search></gcse:search>
    </div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="auto_examples/index.html" title="3.1.6.1. Examples"
             >下一页</a></li>
        <li class="right" >
          <a href="../index.html" title="3. Packages and applications"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Scipy lecture notes</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >3. Packages and applications</a> &#187;</li>
     
    <!-- Insert a menu in the navigation bar -->
    <li class="left">
	<!-- On click toggle the 'tip' on or off-->
	<a onclick="$('.tip').each(function (index, obj) {
			    collapse_tip_div(obj);
		    });
		    $('.tip').addClass('collapsed');
		    $('.left').addClass('transparent');">
	<img src="../../_static/minus.png"
         alt="Collapse to compact view" style="padding: 1ex;"/>
	<span class="hiddenlink">Collapse document to compact view</span>
    </a></li>
    <li class="right edit_on_github"><a href="https://github.com/jayleicn/scipy-lecture-notes-zh-CN/edit/master/packages/statistics/index.rst">Edit
    <span class="tooltip">
	Improve this page:<br/>Translate/Improve it on Github.
    </span>
    </a>
    </li>

      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6 创建。
    </div>
  </body>
</html>